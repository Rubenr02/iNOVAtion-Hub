<?php
// Create connection
$conn = mysqli_connect("localhost", "root", "", "psi");

if (mysqli_connect_errno()) {
    echo "Failed to connect to MySQL: " . mysqli_connect_errno();
}

// Start or resume the session
session_start();

// Check if the post ID is set in the URL
if (isset($_GET['post_id'])) {
    $post_id = $_GET['post_id'];

    // Fetch post information from the database based on the post ID
    $postQuery = "SELECT * FROM IDEAS WHERE IDEAID = '$post_id'";
    $postResult = $conn->query($postQuery);

    if ($postResult->num_rows == 1) {
        $postRow = $postResult->fetch_assoc();

        $postTitle = $postRow['TITLE'];
        $tagID = $postRow['TAGID'];
        $postContent = $postRow['TEXT'];
        $postImage = $postRow['IMAGE'];
        $userID = $postRow['USERID'];
        $votescore = $postRow['VOTESCORE'];

        // Fetch tag information from TAGS table
        $tagQuery = "SELECT TAGS FROM tags WHERE TAGID = '$tagID'";
        $tagResult = $conn->query($tagQuery);

        if ($tagResult->num_rows == 1) {
            $tagRow = $tagResult->fetch_assoc();
            $tagName = $tagRow['TAGS'];
        } else {
            echo "Error fetching tag information.";
        }

        // Fetch Username information from USERS table (for the post)
        $userQuery = "SELECT USERNAME FROM users WHERE USERID = '$userID'";
        $userResult = $conn->query($userQuery);

        if ($userResult->num_rows == 1) {
            $userRow = $userResult->fetch_assoc();
            $userName = $userRow['USERNAME'];
        } else {
            echo "Error fetching Name information.";
        }
    } else {
        echo "Post not found.";
    }
} else {
    echo "Post ID not provided.";
}
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iNOVAtion Hub</title>
    <link rel="stylesheet" href="Styling/Post-css.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
</head>

<body>

    <header>
        <!-- Your header content -->
    </header>

    <!-- Post Template -->
    <div class="post">
        <!-- Display post information dynamically -->
        <div class="post-header">
            <div class="user-info">
                <img src="Images/persona.avif" alt="User Profile Picture">
                <span class="username"><?php echo $userName; ?></span>
            </div>
            <br>
            <h2 class="post-title"><?php echo $postTitle; ?></h2>
            <div class="post-tag">
                <span class="input-type">Problem</span>
                <span class="input-tag"><?php echo $tagName; ?></span>
                <!-- Add other post information here -->
            </div>
        </div>
        <!-- Continue displaying the rest of the post content dynamically -->
    </div>

    <script src="Scripts/iNOVAtion-js.js"></script>
    <script src="Scripts/ViewPost-js.js"></script>

</body>

</html>
